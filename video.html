<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="css/mui.min.css" />
		<link rel="stylesheet" href="css/iconfont.css" />
		<link rel="stylesheet" href="css/kimkra.css" />
		<style>
			body,
			html {
				margin: 0;
				padding: 0;
			}
			
			.poster {
				position: relative;
			}
			
			iframe {
				width: 100%;
				height: 100%;
				border: 0;
				position: absolute;
				top: 0;
				display: none;
			}
			
			img {
				width: 100%;
				background-size: 101% 101%;
				background-repeat: no-repeat;
				background-position: center;
				position: relative;
				display: block;
				z-index: 999;
			}
			
			.mui-scroll {
				padding-bottom: 3.5rem;
			}
		</style>
	</head>

	<body>
		<div class="mui-scroll-wrapper">
			<div class="mui-scroll">
				<div class="video-content">
					<div class="poster">
						<img class="posterImg" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAZwAAADhCAYAAAD8igOSAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QjBCNDE5MUQzNTU1MTFFN0FFQzg4N0UwNjgxQkFBRkUiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QjBCNDE5MUUzNTU1MTFFN0FFQzg4N0UwNjgxQkFBRkUiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpCMEI0MTkxQjM1NTUxMUU3QUVDODg3RTA2ODFCQUFGRSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpCMEI0MTkxQzM1NTUxMUU3QUVDODg3RTA2ODFCQUFGRSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PgQ3IMUAAA2ISURBVHja7N0LcJVV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" />
					</div>
					<h1 class="font-size13 warp2 title"></h1>
					<div class="info-bar flex flex-spacebetween">
						<font class="iconfont icon-yonghu"></font>
						<button>+关注</button>
						<div class="flex-grow"></div>
						<font class="iconfont icon-zan"></font>
						<font class="iconfont icon-hongbao"></font>
						<font class="iconfont icon-gengduo"></font>
					</div>
					<p class="through-line">
						<span>广告</span>
					</p>
					<div class="ads">
						<img src="img/ads.jpg" />
					</div>
					<p class="through-line">
						<span>评论</span>
					</p>
					<div class="discussWrapper">
						<img class="loader" src="" />
					</div>
				</div>
			</div>
			<div class="control">
				<div class="cover">
					<div class="mui-input">
						<textarea type="text" placeholder="请发表重要讲话"></textarea>
					</div>
					<button class="commitDiscuss">发表</button>
					<font class="mui-pull-right iconfont icon-fenxiang"></font>
				</div>
			</div>
		</div>
		<script type="text/javascript" src="js/mui.scroll.js"></script>
		<script>
			(function() {
				var params = parent.Kimkra.Util.getQueryString(location.href);
				bindData();
				setTimeout(bindEvent, 0)
				var iframe;
				var playEnd = false;
				var played = false;

				function bindData() {
					document.querySelector(".posterImg").style.backgroundImage = "url(img/img.png)";
					document.querySelector(".title").innerText = parent.Kimkra.data.videoInfo[params.id].title;
					document.querySelector(".icon-yonghu").innerText = "这是汤不热";
					document.querySelector(".info-bar .icon-zan").innerText = "15";
					document.querySelector(".video-content").style.display = "initial"
				};

				function bindEvent() {
					mui(".mui-scroll-wrapper").scroll();
					window.addEventListener("tap", function(e) {
						if(e.target.nodeName === "IFRAME") {
							//穿透点击事件
							var point = e.detail.touches[0];
							var p = iframe.contentDocument.elementFromPoint(point.clientX, point.clientY);
							p.dispatchEvent(new MouseEvent("click"));
						}
						if(e.target.className === "posterImg") {
							//如果第首次播放
							e.target.style.zIndex = 0;
							iframe.style.display="initial";
							played = true;
							var point = e.detail.touches[0];
							var p = iframe.contentDocument.querySelector(".x-video-button");
							p.dispatchEvent(new MouseEvent("click"));
						}
						console.log(p);
					});
					window.addEventListener("touchend", function(e) {
						if(e.target.nodeName === "IFRAME") {
							var point = e.changedTouches[0];
							var p = e.target.contentDocument.elementFromPoint(point.clientX, point.clientY);
							var _e = new TouchEvent(e.type, {
								bubbles: true,
								changedTouches: e.changedTouches,
								touches: e.touches,
							});
							p.dispatchEvent(_e);
						}
					});
					window.addEventListener("pause", function(e) {
						if(played && !playEnd) {
							iframe.contentWindow.player.pauseVideo();
						}
					});

					function autoPlay() {
						//哔了狗了 一会儿能自动播放 一会儿不能
						console.log(iframe);
						var playButton = iframe.contentDocument.querySelector(".x-video-button");
						console.log(playButton)
						if(playButton) {
							iframe.style.display="initial";
							document.querySelector(".posterImg").style.zIndex = 0;
							played = true;
							playButton.dispatchEvent(new MouseEvent("click"));
						}
					}
					window.addEventListener("playEnd", function(e) {
						playEnd = true;
						iframe.contentWindow.location.reload();
					});
					window.addEventListener("loadDiscuss", function() {
						//doAjax 加载评论
						var discusswrapper = document.querySelector(".discussWrapper");
						if(discusswrapper.querySelector(".loader")) {
							discusswrapper.innerHTML = "";
							discusswrapper.appendChild(parent.Kimkra.discussView());
						}
						autoPlay.call(this);
					});

					function hideVideo() {
						if(played) {
							document.querySelector(".posterImg").style.zIndex = 999;
							iframe.contentDocument.querySelector("video").style.display = "none";
						}
					}

					function showVideo() {
						if(played) {
							iframe.contentDocument.querySelector("video").style.display = "inline";
							document.querySelector(".posterImg").style.zIndex = 0;
						}
					}
					window.addEventListener("hideVideo", function() {
						hideVideo();
					});

					window.addEventListener("showVideo", function() {
						showVideo();
					});
					window.addEventListener("hiddenControl", function() {
						parent.document.querySelector("#iframe" + params.id).style.pointerEvents = "none";
						document.querySelector(".control").classList.remove("active");
						iframe.contentDocument.querySelector("video").style.display = "inline";
					});
					document.querySelector(".control").addEventListener("tap", function(e) {
						if(e.target.nodeName === "TEXTAREA") {
							parent.document.querySelector("#iframe" + params.id).style.pointerEvents = "all";
							this.classList.add("active");
							hideVideo();
							var href = parent.location.href;
							if(href.indexOf("#control") === -1) {
								parent.Kimkra.router.load(href + "#control");
							}
							if(mui.os.ios) {
								setTimeout(function() {
									//call防止iOS不触发focus
									e.target.focus();
								}.call(this), 50)
							}
							if(mui.os.android) {
								setTimeout(function() {
									//延迟50ms执行获取焦点 防止x5莫名其妙的失去焦点一次
									e.target.focus();
								}, 50)
							}

						} else {
							parent.document.querySelector("#iframe" + params.id).style.pointerEvents = "none";
							this.classList.remove("active");
							showVideo();
							parent.Kimkra.router.back();
							document.querySelector("textarea").blur();
						}
					});

					document.querySelector("textarea").addEventListener("blur", function(e) {
						console.log(e)
					});

					document.querySelector(".commitDiscuss").addEventListener("tap", function() {
						parent.mui.toast("发表成功!");
						document.querySelector("textarea").value = "";
					});
				};

				setTimeout(function() {
					iframe = document.createElement("iframe");
					iframe.src = "youku.html";
					document.querySelector(".poster").appendChild(iframe);
					iframe.addEventListener("load", function() {
						document.querySelector(".posterImg").style.zIndex = 999;
						this.contentWindow.dispatchEvent(new CustomEvent("init", {
							detail: parent.Kimkra.data.videoInfo[params.id]
						}))
						if(playEnd) {
							playEnd = false;
							played = false;
							parent.dispatchEvent(new CustomEvent("next"));
						}
					})
				}, 50)
			})()
		</script>
	</body>

</html>